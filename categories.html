<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, minimum-scale=1.0">
    <title>Categories | Adeola's Sprightly Accessories</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
        }

        :root {
            --primary-blue: #1a3a8f;
            --secondary-blue: #2d55cc;
            --light-blue: #e8f0fe;
            --accent-gold: #d4af37;
            --dark-text: #333;
            --light-text: #fff;
            --gray-bg: #f8f9fa;
            --success-green: #28a745;
            --error-red: #dc3545;
            --warning-orange: #ff9800;
            --shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            --shadow-heavy: 0 4px 12px rgba(0, 0, 0, 0.12);
            --gradient-primary: linear-gradient(135deg, #1a3a8f 0%, #2d55cc 100%);
            --gradient-gold: linear-gradient(135deg, #d4af37 0%, #f0c24f 100%);
        }

        html, body {
            max-width: 100%;
            overflow-x: hidden;
            scroll-behavior: smooth;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            color: var(--dark-text);
            line-height: 1.6;
            background-color: var(--gray-bg);
            font-size: 16px;
        }

        img {
            max-width: 100%;
            height: auto;
        }

        /* Loading Overlay */
        #loadingOverlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.98);
            z-index: 2000;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            transition: opacity 0.3s;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary-blue);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Header and Navigation - Mobile Optimized */
        header {
            background-color: var(--primary-blue);
            color: var(--light-text);
            padding: 0.75rem 0;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: var(--shadow);
            height: 64px;
        }

        .container {
            width: 100%;
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 16px;
        }

        .header-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 100%;
        }

        .logo {
            font-size: 1.4rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            text-decoration: none;
            color: var(--light-text);
            padding: 8px 0;
            z-index: 1002;
        }

        .logo i {
            color: var(--accent-gold);
            margin-right: 8px;
            font-size: 1.3rem;
        }

        .logo span {
            color: var(--accent-gold);
            font-weight: 600;
        }

        /* Mobile Navigation */
        .mobile-menu-btn {
            display: flex;
            background: none;
            border: none;
            color: white;
            font-size: 1.4rem;
            cursor: pointer;
            padding: 10px;
            min-height: 44px;
            min-width: 44px;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
            transition: background-color 0.3s;
            z-index: 1002;
        }

        .mobile-menu-btn:active {
            background-color: rgba(255, 255, 255, 0.1);
        }

        nav {
            position: relative;
        }

        #navMenu {
            position: fixed;
            top: 64px;
            left: 0;
            right: 0;
            background-color: var(--primary-blue);
            flex-direction: column;
            align-items: stretch;
            padding: 0;
            transform: translateY(-100%);
            opacity: 0;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-heavy);
            z-index: 1001;
            height: calc(100vh - 64px);
            overflow-y: auto;
            display: flex;
            visibility: hidden;
            pointer-events: none;
        }

        #navMenu.active {
            transform: translateY(0);
            opacity: 1;
            visibility: visible;
            pointer-events: auto;
        }

        #navMenu li {
            margin: 0;
            width: 100%;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        #navMenu li a {
            color: var(--light-text);
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 18px 20px;
            width: 100%;
            font-size: 1rem;
            background-color: transparent;
        }

        #navMenu li a:active {
            background-color: rgba(255, 255, 255, 0.1);
        }

        #navMenu li a i {
            width: 20px;
            text-align: center;
        }

        .dropdown-menu {
            display: none;
            background: rgba(0, 0, 0, 0.1);
            box-shadow: none;
            margin-left: 20px;
            width: calc(100% - 40px);
            position: static;
            opacity: 1;
            visibility: visible;
            transform: none;
            padding: 0;
        }

        #navMenu li.show-dropdown .dropdown-menu {
            display: block;
        }

        .dropdown-menu a {
            padding: 16px 20px;
            color: rgba(255, 255, 255, 0.9);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .dropdown-menu a:active {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 1002;
        }

        .cart-icon {
            position: relative;
            cursor: pointer;
            padding: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
            transition: background-color 0.3s;
        }

        .cart-icon:active {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .cart-count {
            position: absolute;
            top: 0;
            right: 0;
            background-color: var(--accent-gold);
            color: var(--dark-text);
            font-size: 0.7rem;
            font-weight: bold;
            min-width: 18px;
            min-height: 18px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2px;
        }

        /* Desktop Navigation */
        @media (min-width: 768px) {
            .mobile-menu-btn {
                display: none;
            }
            
            #navMenu {
                position: static;
                flex-direction: row;
                height: auto;
                background: transparent;
                opacity: 1;
                transform: none;
                box-shadow: none;
                padding: 0;
                display: flex !important;
                visibility: visible;
                pointer-events: auto;
            }
            
            #navMenu li {
                width: auto;
                border-bottom: none;
            }
            
            #navMenu li a {
                padding: 0.75rem 1rem;
                height: 72px;
                display: flex;
                align-items: center;
            }
            
            #navMenu li a:hover {
                color: var(--accent-gold);
                background-color: rgba(255, 255, 255, 0.1);
            }
            
            .dropdown-menu {
                position: absolute;
                top: 100%;
                left: 0;
                background: white;
                min-width: 220px;
                box-shadow: var(--shadow-heavy);
                border-radius: 8px;
                padding: 0.5rem 0;
                opacity: 0;
                visibility: hidden;
                transform: translateY(10px);
                transition: all 0.3s;
                z-index: 100;
                display: block;
            }
            
            #navMenu li:hover .dropdown-menu {
                opacity: 1;
                visibility: visible;
                transform: translateY(0);
            }
            
            .dropdown-menu a {
                color: var(--dark-text);
                padding: 0.75rem 1.25rem;
                background: white;
            }
            
            .dropdown-menu a:hover {
                background-color: var(--light-blue);
                color: var(--primary-blue);
            }
        }

        /* Rest of your CSS remains the same... */
        /* Page Header - Mobile Optimized */
        .page-header {
            background: var(--gradient-primary);
            color: var(--light-text);
            padding: 3rem 0 2rem;
            text-align: center;
            margin-bottom: 1.5rem;
            position: relative;
            overflow: hidden;
        }

        .page-header h1 {
            font-size: 2rem;
            margin-bottom: 0.75rem;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.2);
            position: relative;
            z-index: 1;
            line-height: 1.3;
            padding: 0 1rem;
        }

        .page-header p {
            max-width: 600px;
            margin: 0 auto;
            font-size: 1rem;
            opacity: 0.9;
            position: relative;
            z-index: 1;
            line-height: 1.5;
            padding: 0 1rem;
        }

        .breadcrumb {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 0.5rem;
            margin-top: 1.2rem;
            font-size: 0.85rem;
            position: relative;
            z-index: 1;
            flex-wrap: wrap;
            padding: 0 1rem;
        }

        .breadcrumb a {
            color: var(--accent-gold);
            text-decoration: none;
            font-weight: 500;
        }

        /* Main Content Layout - Mobile First */
        .category-layout {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            margin-bottom: 3rem;
        }

        /* Sidebar Filters - Mobile Optimized */
        .sidebar {
            width: 100%;
        }

        .filter-toggle {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
            background: white;
            border-radius: 12px;
            margin-bottom: 1rem;
            box-shadow: var(--shadow);
            cursor: pointer;
            border: none;
            width: 100%;
            font-size: 1rem;
            font-weight: 600;
            color: var(--primary-blue);
        }

        .filter-toggle i {
            transition: transform 0.3s;
        }

        .filter-toggle.active i {
            transform: rotate(180deg);
        }

        .filter-card {
            background: white;
            border-radius: 12px;
            padding: 1.25rem;
            margin-bottom: 1rem;
            box-shadow: var(--shadow);
            display: none;
        }

        .filter-card.active {
            display: block;
        }

        .filter-card h3 {
            color: var(--primary-blue);
            margin-bottom: 1.25rem;
            padding-bottom: 0.75rem;
            border-bottom: 2px solid var(--light-blue);
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .filter-card h3 i {
            color: var(--accent-gold);
        }

        .filter-group {
            margin-bottom: 1.5rem;
        }

        .filter-group:last-child {
            margin-bottom: 0;
        }

        .filter-group h4 {
            color: var(--dark-text);
            margin-bottom: 0.75rem;
            font-size: 0.95rem;
            font-weight: 600;
        }

        .filter-options {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .filter-option {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            cursor: pointer;
            padding: 4px 0;
        }

        .filter-option input[type="checkbox"] {
            width: 20px;
            height: 20px;
            accent-color: var(--primary-blue);
            cursor: pointer;
            flex-shrink: 0;
        }

        .filter-option label {
            cursor: pointer;
            flex: 1;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.95rem;
            user-select: none;
        }

        .filter-count {
            background: var(--light-blue);
            color: var(--primary-blue);
            padding: 0.2rem 0.6rem;
            border-radius: 10px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-left: auto;
            flex-shrink: 0;
        }

        .price-range {
            width: 100%;
            margin: 1rem 0;
            height: 6px;
            -webkit-appearance: none;
            appearance: none;
            background: var(--light-blue);
            border-radius: 3px;
            outline: none;
        }

        .price-range::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: var(--primary-blue);
            cursor: pointer;
            border: 3px solid white;
            box-shadow: var(--shadow);
        }

        .price-range::-moz-range-thumb {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: var(--primary-blue);
            cursor: pointer;
            border: 3px solid white;
            box-shadow: var(--shadow);
        }

        .price-values {
            display: flex;
            justify-content: space-between;
            margin-top: 0.5rem;
            font-size: 0.9rem;
            color: #666;
            flex-wrap: wrap;
        }

        .color-options {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
        }

        .color-option {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.3s;
            position: relative;
            flex-shrink: 0;
        }

        .color-option:active, .color-option.active {
            transform: scale(1.1);
            border-color: var(--dark-text);
        }

        .color-option.active::after {
            content: '✓';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 0.9rem;
            font-weight: bold;
            text-shadow: 0 0 3px rgba(0,0,0,0.5);
        }

        .size-options {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
        }

        .size-option {
            min-width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--light-blue);
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            font-size: 0.95rem;
            flex-shrink: 0;
        }

        .size-option:active, .size-option.active {
            background: var(--primary-blue);
            color: white;
        }

        .filter-actions {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 0.9rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            font-size: 1rem;
            text-align: center;
            min-height: 48px;
            min-width: 44px;
            flex: 1;
            touch-action: manipulation;
        }

        .btn:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .btn-primary {
            background-color: var(--primary-blue);
            color: white;
        }

        .btn-primary:active {
            background-color: var(--secondary-blue);
        }

        .btn-outline {
            background-color: transparent;
            border: 2px solid var(--primary-blue);
            color: var(--primary-blue);
        }

        .btn-outline:active {
            background-color: var(--light-blue);
        }

        .btn-success {
            background-color: var(--success-green);
            color: white;
        }

        .btn-warning {
            background-color: var(--warning-orange);
            color: white;
        }

        /* Products Section - Mobile Optimized */
        .products-section {
            flex: 1;
        }

        .products-header {
            background: white;
            border-radius: 12px;
            padding: 1.25rem;
            margin-bottom: 1.5rem;
            box-shadow: var(--shadow);
        }

        .products-header h2 {
            color: var(--primary-blue);
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
        }

        .products-stats {
            color: #666;
            font-size: 0.9rem;
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            align-items: center;
            margin-bottom: 1.25rem;
        }

        .products-controls {
            display: flex;
            align-items: center;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .sort-select {
            padding: 0.75rem 1rem;
            border: 2px solid var(--light-blue);
            border-radius: 8px;
            background: white;
            color: var(--dark-text);
            font-size: 1rem;
            cursor: pointer;
            min-height: 48px;
            flex: 1;
            min-width: 0;
        }

        .view-options {
            display: flex;
            gap: 0.5rem;
        }

        .view-btn {
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--light-blue);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            color: var(--dark-text);
            transition: all 0.3s;
            flex-shrink: 0;
        }

        .view-btn:active, .view-btn.active {
            background: var(--primary-blue);
            color: white;
        }

        /* Category Navigation - Mobile Optimized */
        .category-nav {
            background: white;
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 1.5rem;
            box-shadow: var(--shadow);
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
        }

        .category-nav::-webkit-scrollbar {
            display: none;
        }

        .category-nav ul {
            display: flex;
            list-style: none;
            gap: 0.75rem;
            min-width: min-content;
            padding: 0.25rem;
        }

        .category-nav a {
            padding: 0.75rem 1.25rem;
            background: var(--light-blue);
            border-radius: 30px;
            text-decoration: none;
            color: var(--primary-blue);
            font-weight: 600;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            white-space: nowrap;
            flex-shrink: 0;
        }

        .category-nav a:active, .category-nav a.active {
            background: var(--primary-blue);
            color: white;
        }

        /* Products Grid - Mobile Optimized */
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.25rem;
            margin-bottom: 2rem;
        }

        /* Products List View */
        .products-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .product-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: all 0.3s;
            position: relative;
        }

        .product-card.grid-view {
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .product-card.list-view {
            display: flex;
            flex-direction: column;
        }

        .product-card.list-view .product-img {
            width: 100%;
            height: 200px;
        }

        .product-img {
            height: 200px;
            background: var(--light-blue);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        .product-img img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s;
        }

        .product-badge {
            position: absolute;
            top: 12px;
            right: 12px;
            background: var(--accent-gold);
            color: var(--dark-text);
            padding: 0.3rem 0.75rem;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 600;
            z-index: 2;
        }

        .product-info {
            padding: 1.25rem;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }

        .product-category {
            color: var(--secondary-blue);
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 0.5rem;
        }

        .product-title {
            color: var(--primary-blue);
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            line-height: 1.4;
        }

        .product-description {
            color: #666;
            font-size: 0.9rem;
            line-height: 1.5;
            margin-bottom: 1rem;
            flex-grow: 1;
        }

        .product-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
            margin-bottom: 1rem;
            font-size: 0.85rem;
            color: #777;
        }

        .product-meta span {
            display: flex;
            align-items: center;
            gap: 0.3rem;
            flex-wrap: nowrap;
        }

        .price-section {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1.25rem;
            flex-wrap: wrap;
        }

        .current-price {
            color: var(--accent-gold);
            font-size: 1.25rem;
            font-weight: 700;
        }

        .old-price {
            color: #999;
            text-decoration: line-through;
            font-size: 1rem;
        }

        .product-actions {
            display: flex;
            gap: 0.75rem;
            margin-top: auto;
        }

        .btn-sm {
            padding: 0.75rem 1rem;
            font-size: 0.95rem;
            min-height: 44px;
            flex: 1;
        }

        .btn-gold {
            background: var(--gradient-gold);
            color: var(--dark-text);
            border: none;
        }

        .btn-gold:active {
            background: linear-gradient(135deg, #f0c24f 0%, #d4af37 100%);
        }

        /* Cart Sidebar - Mobile Optimized */
        .cart-sidebar {
            position: fixed;
            top: 0;
            right: -100%;
            width: 100%;
            height: 100vh;
            background: white;
            box-shadow: var(--shadow-heavy);
            z-index: 2000;
            transition: right 0.3s ease-in-out;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        .cart-sidebar.open {
            right: 0;
        }

        .cart-header {
            padding: 1.25rem;
            background: var(--primary-blue);
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 1;
        }

        .cart-header h3 {
            margin: 0;
            font-size: 1.2rem;
        }

        .close-cart {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 8px;
            min-width: 44px;
            min-height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .cart-items {
            flex: 1;
            padding: 1.25rem;
            overflow-y: auto;
        }

        .cart-item {
            display: flex;
            gap: 1rem;
            padding: 1rem 0;
            border-bottom: 1px solid #eee;
        }

        .cart-item:last-child {
            border-bottom: none;
        }

        .cart-item-img {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 8px;
            flex-shrink: 0;
        }

        .cart-item-details {
            flex: 1;
            min-width: 0;
        }

        .cart-item-title {
            font-weight: 600;
            margin-bottom: 0.5rem;
            font-size: 0.95rem;
            word-wrap: break-word;
        }

        .cart-item-price {
            color: var(--accent-gold);
            font-weight: 600;
            margin-bottom: 0.5rem;
            font-size: 1rem;
        }

        .cart-item-quantity {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .quantity-btn {
            width: 32px;
            height: 32px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
        }

        .cart-item-remove {
            background: none;
            border: none;
            color: var(--error-red);
            cursor: pointer;
            font-size: 1rem;
            padding: 8px;
            min-width: 44px;
            min-height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .cart-footer {
            padding: 1.25rem;
            background: var(--light-blue);
            border-top: 1px solid #ddd;
            position: sticky;
            bottom: 0;
        }

        .cart-total {
            display: flex;
            justify-content: space-between;
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 1.25rem;
        }

        .cart-actions {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .empty-cart {
            text-align: center;
            padding: 3rem 1.25rem;
            color: #666;
        }

        .empty-cart i {
            font-size: 3rem;
            margin-bottom: 1rem;
            color: var(--light-blue);
        }

        /* Payment Modal - Mobile Optimized */
        .payment-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 3000;
            align-items: flex-start;
            justify-content: center;
            padding: 0;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        .payment-modal-content {
            background: white;
            border-radius: 12px;
            width: 100%;
            height: 100vh;
            overflow-y: auto;
            position: relative;
            animation: slideInUp 0.3s ease-out;
            margin: 0;
        }

        @keyframes slideInUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .payment-header {
            padding: 1.25rem;
            background: var(--primary-blue);
            color: white;
            border-radius: 12px 12px 0 0;
            position: sticky;
            top: 0;
            z-index: 1;
        }

        .payment-header h2 {
            margin: 0;
            font-size: 1.3rem;
        }

        .payment-body {
            padding: 1.25rem;
        }

        .bank-details {
            background: var(--light-blue);
            padding: 1.25rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
        }

        .bank-details h3 {
            color: var(--primary-blue);
            margin-bottom: 1rem;
            font-size: 1.1rem;
        }

        .bank-info {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .bank-item {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .bank-label {
            font-weight: 600;
            color: var(--primary-blue);
            font-size: 0.9rem;
        }

        .bank-value {
            font-size: 1rem;
            font-weight: 600;
            word-break: break-all;
        }

        .payment-form {
            display: flex;
            flex-direction: column;
            gap: 1.25rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .form-group label {
            font-weight: 600;
            color: var(--dark-text);
            font-size: 0.95rem;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            padding: 0.9rem 1rem;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s;
            width: 100%;
            min-height: 48px;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 3px rgba(26, 58, 143, 0.1);
        }

        .file-upload {
            position: relative;
            border: 2px dashed #ddd;
            border-radius: 8px;
            padding: 2rem 1rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .file-upload:active {
            border-color: var(--primary-blue);
            background: var(--light-blue);
        }

        .file-upload input[type="file"] {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            cursor: pointer;
        }

        .file-upload i {
            font-size: 2rem;
            color: var(--primary-blue);
            margin-bottom: 1rem;
        }

        .payment-summary {
            background: #f8f9fa;
            padding: 1.25rem;
            border-radius: 8px;
            margin-bottom: 1.25rem;
        }

        .payment-summary h3 {
            color: var(--primary-blue);
            margin-bottom: 1rem;
            font-size: 1.1rem;
        }

        .summary-item {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px solid #eee;
            font-size: 0.95rem;
        }

        .summary-item:last-child {
            border-bottom: none;
            font-weight: 600;
            font-size: 1.2rem;
            color: var(--accent-gold);
        }

        .payment-actions {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-top: 1.5rem;
        }

        /* Notification - Mobile Optimized */
        .notification {
            position: fixed;
            top: 20px;
            left: 20px;
            right: 20px;
            padding: 1rem 1.25rem;
            border-radius: 8px;
            box-shadow: var(--shadow-heavy);
            z-index: 2001;
            display: flex;
            align-items: center;
            gap: 10px;
            animation: slideInDown 0.3s ease-out;
            color: white;
            font-weight: 500;
            font-size: 0.95rem;
        }

        .notification.success {
            background: var(--success-green);
        }

        .notification.error {
            background: var(--error-red);
        }

        .notification.info {
            background: var(--primary-blue);
        }

        @keyframes slideInDown {
            from { transform: translateY(-20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes slideOutUp {
            from { transform: translateY(0); opacity: 1; }
            to { transform: translateY(-20px); opacity: 0; }
        }

        /* No Results */
        .no-results {
            text-align: center;
            padding: 3rem 1.25rem;
            background: white;
            border-radius: 12px;
            box-shadow: var(--shadow);
        }

        .no-results i {
            font-size: 3rem;
            color: var(--light-blue);
            margin-bottom: 1.5rem;
        }

        .no-results h3 {
            color: var(--primary-blue);
            margin-bottom: 0.75rem;
            font-size: 1.3rem;
        }

        .no-results p {
            color: #666;
            margin-bottom: 1.5rem;
            font-size: 1rem;
        }

        /* Pagination - Mobile Optimized */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin-top: 2rem;
        }

        .pagination a, .pagination span {
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 44px;
            min-height: 44px;
            padding: 0 0.5rem;
            border-radius: 8px;
            text-decoration: none;
            color: var(--primary-blue);
            font-weight: 600;
            background: white;
            border: 2px solid var(--light-blue);
            transition: all 0.3s;
        }

        .pagination a:active {
            background: var(--primary-blue);
            color: white;
            border-color: var(--primary-blue);
        }

        .pagination a.active {
            background: var(--primary-blue);
            color: white;
            border-color: var(--primary-blue);
        }

        .pagination span.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Product Details Modal - Mobile Optimized */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 3000;
            align-items: flex-start;
            justify-content: center;
            padding: 0;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        /* Desktop Styles */
        @media (min-width: 768px) {
            .container {
                padding: 0 24px;
            }
            
            header {
                padding: 0;
                height: 72px;
            }
            
            .logo {
                font-size: 1.6rem;
            }
            
            .mobile-menu-btn {
                display: none;
            }
            
            #navMenu {
                position: static;
                flex-direction: row;
                height: auto;
                background: transparent;
                opacity: 1;
                transform: none;
                box-shadow: none;
                padding: 0;
                display: flex !important;
                visibility: visible;
                pointer-events: auto;
            }
            
            #navMenu li {
                width: auto;
                border-bottom: none;
            }
            
            #navMenu li a {
                padding: 0.75rem 1rem;
                height: 72px;
                display: flex;
                align-items: center;
            }
            
            #navMenu li a:hover {
                color: var(--accent-gold);
                background-color: rgba(255, 255, 255, 0.1);
            }
            
            .dropdown-menu {
                position: absolute;
                top: 100%;
                left: 0;
                background: white;
                min-width: 220px;
                box-shadow: var(--shadow-heavy);
                border-radius: 8px;
                padding: 0.5rem 0;
                opacity: 0;
                visibility: hidden;
                transform: translateY(10px);
                transition: all 0.3s;
                z-index: 100;
                display: block;
            }
            
            #navMenu li:hover .dropdown-menu {
                opacity: 1;
                visibility: visible;
                transform: translateY(0);
            }
            
            .dropdown-menu a {
                color: var(--dark-text);
                padding: 0.75rem 1.25rem;
                background: white;
            }
            
            .dropdown-menu a:hover {
                background-color: var(--light-blue);
                color: var(--primary-blue);
            }
            
            .page-header {
                padding: 4rem 0 3rem;
            }
            
            .page-header h1 {
                font-size: 2.5rem;
            }
            
            .category-layout {
                flex-direction: row;
                gap: 2rem;
            }
            
            .sidebar {
                width: 300px;
                flex-shrink: 0;
            }
            
            .filter-toggle {
                display: none;
            }
            
            .filter-card {
                display: block !important;
            }
            
            .products-header {
                padding: 1.5rem;
            }
            
            .products-header h2 {
                font-size: 1.8rem;
            }
            
            .product-card.list-view {
                flex-direction: row;
            }
            
            .product-card.list-view .product-img {
                width: 200px;
                height: 200px;
            }
            
            .cart-sidebar {
                width: 400px;
                right: -400px;
            }
            
            .payment-modal {
                align-items: center;
                padding: 1rem;
            }
            
            .payment-modal-content {
                width: 100%;
                max-width: 800px;
                height: auto;
                max-height: 90vh;
                margin: auto;
            }
            
            .bank-info {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 1rem;
            }
            
            .payment-actions {
                flex-direction: row;
            }
            
            .notification {
                left: auto;
                right: 20px;
                max-width: 400px;
            }
        }

        @media (min-width: 1024px) {
            .products-grid {
                grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            }
            
            .container {
                padding: 0 32px;
            }
        }

        @media (max-width: 480px) {
            .products-grid {
                grid-template-columns: 1fr;
            }
            
            .filter-actions {
                flex-direction: column;
            }
            
            .product-actions {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }
            
            .payment-body {
                padding: 1rem;
            }
            
            .bank-details {
                padding: 1rem;
            }
            
            .color-options {
                justify-content: center;
            }
            
            .size-options {
                justify-content: center;
            }
        }

        /* Accessibility Improvements */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        /* Focus styles for accessibility */
        button:focus-visible,
        a:focus-visible,
        input:focus-visible,
        select:focus-visible,
        textarea:focus-visible {
            outline: 3px solid var(--accent-gold);
            outline-offset: 2px;
        }

        /* Improve touch targets on mobile */
        @media (max-width: 767px) {
            .btn, 
            .view-btn, 
            .quantity-btn,
            .cart-icon,
            .mobile-menu-btn,
            .close-cart,
            .cart-item-remove,
            .pagination a,
            .category-nav a,
            .filter-option,
            .color-option,
            .size-option {
                min-height: 44px;
                min-width: 44px;
            }
            
            input[type="checkbox"],
            input[type="radio"] {
                min-height: 24px;
                min-width: 24px;
            }
        }

        /* Prevent text size adjustment on orientation change */
        html {
            -webkit-text-size-adjust: 100%;
        }
    </style>
</head>
<body>
    <!-- Loading Overlay -->
    <div id="loadingOverlay">
        <div class="spinner"></div>
        <p>Loading...</p>
    </div>

    <!-- Header -->
    <header>
        <div class="container header-container">
            <a href="index.html" class="logo">
                <i class="fas fa-gem"></i>
                Adeola's <span>Sprightly</span>
            </a>
            
            <nav>
                <ul id="navMenu">
                    <li><a href="index.html"><i class="fas fa-home"></i> Home</a></li>
                    <li id="categoriesMenuItem">
                        <a href="categories.html"><i class="fas fa-list"></i> Categories <i class="fas fa-chevron-down"></i></a>
                        <div class="dropdown-menu" id="categoriesDropdown">
                            <!-- Categories will be loaded here -->
                        </div>
                    </li>
                    <li><a href="index.html#featured"><i class="fas fa-star"></i> Featured</a></li>
                    <li><a href="index.html#about"><i class="fas fa-info-circle"></i> About</a></li>
                    <li><a href="/checkout.html"><i class="fas fa-info-circle"></i> checkout</a></li>
                </ul>
            </nav>
            
            <div class="header-actions">
                <div class="cart-icon" id="cartIcon" aria-label="Shopping cart" role="button" tabindex="0">
                    <i class="fas fa-shopping-cart"></i>
                    <span class="cart-count" id="cartCount">0</span>
                </div>
                
                <button class="mobile-menu-btn" id="mobileMenuBtn" aria-label="Toggle menu" aria-expanded="false">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
        </div>
    </header>

    <!-- Rest of your HTML remains exactly the same... -->
    <!-- Page Header -->
    <div class="page-header">
        <div class="container">
            <h1>Shop by Category</h1>
            <p>Browse our curated collections of premium fashion and accessories. Find exactly what you're looking for with our smart filters.</p>
            <div class="breadcrumb">
                <a href="index.html">Home</a>
                <i class="fas fa-chevron-right"></i>
                <span>All Categories</span>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="container">
        <div class="category-layout">
            <!-- Sidebar Filters -->
            <aside class="sidebar">
                <button class="filter-toggle" id="filterToggle" aria-expanded="false">
                    <span><i class="fas fa-filter"></i> Filter Products</span>
                    <i class="fas fa-chevron-down"></i>
                </button>
                
                <!-- Category Filter -->
                <div class="filter-card" id="filterCard">
                    <h3><i class="fas fa-filter"></i> Filter Products</h3>
                    
                    <div class="filter-group">
                        <h4>Categories</h4>
                        <div class="filter-options" id="categoryFilter">
                            <!-- Categories will be loaded here -->
                        </div>
                    </div>

                    <div class="filter-group">
                        <h4>Price Range</h4>
                        <input type="range" min="0" max="500000" value="250000" class="price-range" id="priceRange" aria-label="Price range slider">
                        <div class="price-values">
                            <span>₦0</span>
                            <span id="currentPrice">₦250,000</span>
                            <span>₦500,000+</span>
                        </div>
                    </div>

                    <div class="filter-group" id="colorFilter">
                        <h4>Color</h4>
                        <div class="color-options">
                            <!-- Colors will be loaded dynamically -->
                        </div>
                    </div>

                    <div class="filter-group" id="sizeFilter">
                        <h4>Size</h4>
                        <div class="size-options">
                            <!-- Sizes will be loaded dynamically -->
                        </div>
                    </div>

                    <div class="filter-actions">
                        <button class="btn btn-primary" id="applyFilters">
                            <i class="fas fa-check"></i> Apply Filters
                        </button>
                        <button class="btn btn-outline" id="resetFilters">
                            <i class="fas fa-redo"></i> Reset
                        </button>
                    </div>
                </div>

                <!-- Quick Stats -->
                <div class="filter-card">
                    <h3><i class="fas fa-chart-bar"></i> Quick Stats</h3>
                    <div class="filter-options">
                        <div class="filter-option">
                            <span>Total Products:</span>
                            <span class="filter-count" id="totalProductsCount">0</span>
                        </div>
                        <div class="filter-option">
                            <span>Active Filters:</span>
                            <span class="filter-count" id="activeFiltersCount">0</span>
                        </div>
                        <div class="filter-option">
                            <span>Showing:</span>
                            <span class="filter-count" id="showingCount">0</span>
                        </div>
                    </div>
                </div>
            </aside>

            <!-- Products Section -->
            <main class="products-section">
                <!-- Category Navigation -->
                <div class="category-nav">
                    <ul id="categoryNav">
                        <!-- Categories will be loaded here -->
                    </ul>
                </div>

                <!-- Products Header -->
                <div class="products-header">
                    <div>
                        <h2 id="currentCategoryTitle">All Products</h2>
                        <div class="products-stats">
                            <span id="productsCount">0 products</span>
                            <span> • </span>
                            <span id="priceRangeText">₦0 - ₦500,000</span>
                        </div>
                    </div>
                    <div class="products-controls">
                        <div class="view-options">
                            <button class="view-btn active" data-view="grid" title="Grid View" aria-label="Grid View">
                                <i class="fas fa-th-large"></i>
                            </button>
                            <button class="view-btn" data-view="list" title="List View" aria-label="List View">
                                <i class="fas fa-list"></i>
                            </button>
                        </div>
                        <select class="sort-select" id="sortSelect" aria-label="Sort products by">
                            <option value="featured">Featured</option>
                            <option value="price-low">Price: Low to High</option>
                            <option value="price-high">Price: High to Low</option>
                            <option value="name">Name A-Z</option>
                            <option value="newest">Newest Arrivals</option>
                            <option value="popular">Most Popular</option>
                        </select>
                    </div>
                </div>

                <!-- Products Grid/List -->
                <div id="productsContainer">
                    <div class="products-grid" id="productsGrid">
                        <!-- Products will be loaded here -->
                    </div>
                </div>

                <!-- No Results Message -->
                <div class="no-results" id="noResults" style="display: none;">
                    <i class="fas fa-search"></i>
                    <h3>No Products Found</h3>
                    <p>Try adjusting your filters or browse different categories to find what you're looking for.</p>
                    <button class="btn btn-primary" id="clearAllFilters">
                        <i class="fas fa-redo"></i> Clear All Filters
                    </button>
                </div>

                <!-- Pagination -->
                <div class="pagination" id="pagination">
                    <!-- Pagination will be generated here -->
                </div>
            </main>
        </div>
    </div>

    <!-- Cart Sidebar -->
    <div class="cart-sidebar" id="cartSidebar">
        <div class="cart-header">
            <h3>Your Shopping Cart</h3>
            <button class="close-cart" id="closeCart" aria-label="Close cart">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="cart-items" id="cartItems">
            <!-- Cart items will be loaded here -->
        </div>
        <div class="cart-footer">
            <div class="cart-total">
                <span>Total:</span>
                <span id="cartTotal">₦0</span>
            </div>
            <div class="cart-actions">
                <button class="btn btn-primary" id="checkoutBtn">
                    <a href="/checkout.html" style="color: inherit; text-decoration: none;"><i class="fas fa-lock"></i> Proceed to Checkout</a>
                </button>
                <button class="btn btn-outline" id="continueShopping">
                    <i class="fas fa-shopping-cart"></i> Continue Shopping
                </button>
            </div>
        </div>
    </div>

    <!-- Payment Modal -->
    <div class="payment-modal" id="paymentModal">
        <div class="payment-modal-content">
            <div class="payment-header">
                <h2>Complete Your Order</h2>
                <button class="close-cart" id="closePaymentModal" aria-label="Close payment modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="payment-body">
                <!-- Bank Transfer Details -->
                <div class="bank-details">
                    <h3><i class="fas fa-university"></i> Bank Transfer Details</h3>
                    <div class="bank-info">
                        <div class="bank-item">
                            <span class="bank-label">Account Name:</span>
                            <span class="bank-value">OMOTOSO ADEOLA GLORIA</span>
                        </div>
                        <div class="bank-item">
                            <span class="bank-label">Account Number:</span>
                            <span class="bank-value">2080674849</span>
                        </div>
                        <div class="bank-item">
                            <span class="bank-label">Bank Name:</span>
                            <span class="bank-value">Kuda MFB</span>
                        </div>
                    </div>
                    <p style="margin-top: 1rem; color: #666; font-size: 0.9rem;">
                        <i class="fas fa-info-circle"></i> Please transfer the exact amount and upload your payment receipt below.
                    </p>
                </div>

                <!-- Order Summary -->
                <div class="payment-summary">
                    <h3>Order Summary</h3>
                    <div id="orderSummary">
                        <!-- Order items will be loaded here -->
                    </div>
                    <div class="summary-item">
                        <span>Total Amount:</span>
                        <span id="orderTotal">₦0</span>
                    </div>
                </div>

                <!-- Payment Form -->
                <form id="paymentForm">
                    <div class="form-group">
                        <label for="customerName">Full Name *</label>
                        <input type="text" id="customerName" placeholder="Enter your full name" required>
                    </div>

                    <div class="form-group">
                        <label for="customerEmail">Email Address *</label>
                        <input type="email" id="customerEmail" placeholder="Enter your email address" required>
                    </div>

                    <div class="form-group">
                        <label for="customerPhone">Phone Number *</label>
                        <input type="tel" id="customerPhone" placeholder="Enter your phone number" required>
                    </div>

                    <div class="form-group">
                        <label for="deliveryAddress">Delivery Address *</label>
                        <textarea id="deliveryAddress" rows="3" placeholder="Enter your complete delivery address" required></textarea>
                    </div>

                    <div class="form-group">
                        <label for="paymentReceipt">Upload Payment Receipt *</label>
                        <div class="file-upload">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <p>Click to upload payment receipt</p>
                            <p style="font-size: 0.9rem; color: #666;">Supported formats: JPG, PNG, PDF</p>
                            <input type="file" id="paymentReceipt" accept=".jpg,.jpeg,.png,.pdf" required>
                        </div>
                        <div id="fileName" style="margin-top: 0.5rem; font-size: 0.9rem;"></div>
                    </div>

                    <div class="form-group">
                        <label for="additionalNotes">Additional Notes (Optional)</label>
                        <textarea id="additionalNotes" rows="2" placeholder="Any special instructions or notes for your order"></textarea>
                    </div>

                    <div class="payment-actions">
                        <button type="submit" class="btn btn-success" id="submitOrderBtn">
                            <i class="fas fa-paper-plane"></i> Submit Order
                        </button>
                        <button type="button" class="btn btn-outline" id="cancelPaymentBtn">
                            <i class="fas fa-times"></i> Cancel
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCtdGdcnhod-oIetnEvqZ7rA9zE77jAplM",
            authDomain: "ade-ola.firebaseapp.com",
            projectId: "ade-ola",
            storageBucket: "ade-ola.appspot.com",
            messagingSenderId: "459851526370",
            appId: "1:459851526370:web:6eb692497c82937e3daebb",
            measurementId: "G-TTXD16PTB9"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        // Global state
        let allProducts = [];
        let allCategories = [];
        let filteredProducts = [];
        let currentFilters = {
            categories: [],
            price: 250000,
            colors: [],
            sizes: [],
            sortBy: 'featured'
        };
        let currentUser = null;
        let currentView = 'grid';
        let currentPage = 1;
        const productsPerPage = 12;
        let cart = JSON.parse(localStorage.getItem('sprightlyCart')) || [];

        // Format Nigerian Naira currency
        function formatNaira(amount) {
            return '₦' + amount.toLocaleString('en-NG');
        }

        // Initialize on load
        document.addEventListener('DOMContentLoaded', function() {
            init();
        });

        async function init() {
            // Hide loading overlay
            document.getElementById('loadingOverlay').style.display = 'none';
            
            // Check auth state
            auth.onAuthStateChanged((user) => {
                currentUser = user;
            });

            await loadCategories();
            await loadProducts();
            setupEventListeners();
            updateCartDisplay();
            updateUI();
            
            // Initialize mobile filters
            if (window.innerWidth < 768) {
                const filterToggle = document.getElementById('filterToggle');
                const filterCard = document.getElementById('filterCard');
                if (filterToggle && filterCard) {
                    filterToggle.addEventListener('click', () => {
                        const isExpanded = filterToggle.getAttribute('aria-expanded') === 'true';
                        filterToggle.setAttribute('aria-expanded', !isExpanded);
                        filterToggle.classList.toggle('active');
                        filterCard.classList.toggle('active');
                    });
                }
            }
        }

        // Setup event listeners - FIXED HAMBURGER MENU
        function setupEventListeners() {
            // Mobile menu toggle - FIXED
            const mobileMenuBtn = document.getElementById('mobileMenuBtn');
            const navMenu = document.getElementById('navMenu');
            const categoriesMenuItem = document.getElementById('categoriesMenuItem');
            
            console.log('Mobile menu button:', mobileMenuBtn); // Debug
            console.log('Nav menu:', navMenu); // Debug
            
            if (mobileMenuBtn && navMenu) {
                mobileMenuBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const isExpanded = mobileMenuBtn.getAttribute('aria-expanded') === 'true';
                    mobileMenuBtn.setAttribute('aria-expanded', !isExpanded);
                    navMenu.classList.toggle('active');
                    const icon = mobileMenuBtn.querySelector('i');
                    if (navMenu.classList.contains('active')) {
                        icon.classList.remove('fa-bars');
                        icon.classList.add('fa-times');
                        // Prevent body scrolling when menu is open
                        document.body.style.overflow = 'hidden';
                    } else {
                        icon.classList.remove('fa-times');
                        icon.classList.add('fa-bars');
                        // Restore body scrolling
                        document.body.style.overflow = '';
                        // Close dropdowns when closing menu
                        if (categoriesMenuItem) {
                            categoriesMenuItem.classList.remove('show-dropdown');
                        }
                    }
                });

                // Close mobile menu when clicking outside
                document.addEventListener('click', (e) => {
                    if (!navMenu.contains(e.target) && !mobileMenuBtn.contains(e.target)) {
                        navMenu.classList.remove('active');
                        mobileMenuBtn.setAttribute('aria-expanded', 'false');
                        mobileMenuBtn.querySelector('i').classList.remove('fa-times');
                        mobileMenuBtn.querySelector('i').classList.add('fa-bars');
                        // Restore body scrolling
                        document.body.style.overflow = '';
                        if (categoriesMenuItem) {
                            categoriesMenuItem.classList.remove('show-dropdown');
                        }
                    }
                });
            }

            // Categories dropdown on mobile
            if (categoriesMenuItem) {
                const categoriesLink = categoriesMenuItem.querySelector('a');
                if (categoriesLink) {
                    categoriesLink.addEventListener('click', (e) => {
                        if (window.innerWidth < 768) {
                            e.preventDefault();
                            categoriesMenuItem.classList.toggle('show-dropdown');
                        }
                    });
                }
            }

            // Cart icon click
            const cartIcon = document.getElementById('cartIcon');
            if (cartIcon) {
                cartIcon.addEventListener('click', () => {
                    document.getElementById('cartSidebar').classList.add('open');
                    loadCartItems();
                });

                // Cart icon keyboard support
                cartIcon.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        document.getElementById('cartSidebar').classList.add('open');
                        loadCartItems();
                    }
                });
            }

            // Close cart
            const closeCartBtn = document.getElementById('closeCart');
            if (closeCartBtn) {
                closeCartBtn.addEventListener('click', () => {
                    document.getElementById('cartSidebar').classList.remove('open');
                });
            }

            // Continue shopping
            const continueShoppingBtn = document.getElementById('continueShopping');
            if (continueShoppingBtn) {
                continueShoppingBtn.addEventListener('click', () => {
                    document.getElementById('cartSidebar').classList.remove('open');
                });
            }

            // Checkout button
            const checkoutBtn = document.getElementById('checkoutBtn');
            if (checkoutBtn) {
                checkoutBtn.addEventListener('click', () => {
                    if (cart.length === 0) {
                        showNotification('Your cart is empty', 'error');
                        return;
                    }
                    document.getElementById('cartSidebar').classList.remove('open');
                    showPaymentModal();
                });
            }

            // Close payment modal
            const closePaymentModalBtn = document.getElementById('closePaymentModal');
            if (closePaymentModalBtn) {
                closePaymentModalBtn.addEventListener('click', () => {
                    document.getElementById('paymentModal').style.display = 'none';
                });
            }

            // Cancel payment button
            const cancelPaymentBtn = document.getElementById('cancelPaymentBtn');
            if (cancelPaymentBtn) {
                cancelPaymentBtn.addEventListener('click', () => {
                    document.getElementById('paymentModal').style.display = 'none';
                });
            }

            // File upload preview
            const paymentReceiptInput = document.getElementById('paymentReceipt');
            if (paymentReceiptInput) {
                paymentReceiptInput.addEventListener('change', function(e) {
                    const fileName = document.getElementById('fileName');
                    if (this.files.length > 0) {
                        fileName.textContent = `Selected file: ${this.files[0].name}`;
                        fileName.style.color = 'var(--success-green)';
                    } else {
                        fileName.textContent = '';
                    }
                });
            }

            // Payment form submission
            const paymentForm = document.getElementById('paymentForm');
            if (paymentForm) {
                paymentForm.addEventListener('submit', handlePaymentSubmit);
            }

            // View toggle
            document.querySelectorAll('.view-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.view-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    currentView = this.dataset.view;
                    updateProductsDisplay();
                });
            });

            // Price range
            const priceRange = document.getElementById('priceRange');
            const currentPrice = document.getElementById('currentPrice');
            
            if (priceRange && currentPrice) {
                priceRange.addEventListener('input', function() {
                    currentPrice.textContent = formatNaira(parseInt(this.value));
                    currentFilters.price = parseInt(this.value);
                });
            }

            // Sort select
            const sortSelect = document.getElementById('sortSelect');
            if (sortSelect) {
                sortSelect.addEventListener('change', function() {
                    currentFilters.sortBy = this.value;
                    filterProducts();
                });
            }

            // Apply filters
            const applyFiltersBtn = document.getElementById('applyFilters');
            if (applyFiltersBtn) {
                applyFiltersBtn.addEventListener('click', filterProducts);
            }

            // Reset filters
            const resetFiltersBtn = document.getElementById('resetFilters');
            if (resetFiltersBtn) {
                resetFiltersBtn.addEventListener('click', resetFilters);
            }

            // Clear all filters
            const clearAllFiltersBtn = document.getElementById('clearAllFilters');
            if (clearAllFiltersBtn) {
                clearAllFiltersBtn.addEventListener('click', resetFilters);
            }

            // Category nav clicks
            document.addEventListener('click', function(e) {
                if (e.target.closest('.category-nav a')) {
                    e.preventDefault();
                    const category = e.target.closest('a').dataset.category;
                    if (category === 'all') {
                        currentFilters.categories = [];
                    } else {
                        currentFilters.categories = [category];
                    }
                    filterProducts();
                    
                    // Update UI
                    document.querySelectorAll('.category-nav a').forEach(a => a.classList.remove('active'));
                    e.target.closest('a').classList.add('active');
                    
                    // Update title
                    const categoryObj = allCategories.find(c => c.filter === category);
                    if (categoryObj) {
                        const titleElement = document.getElementById('currentCategoryTitle');
                        if (titleElement) {
                            titleElement.textContent = categoryObj.name;
                        }
                    }
                    
                    // Close mobile menu if open
                    if (window.innerWidth < 768) {
                        const navMenu = document.getElementById('navMenu');
                        if (navMenu && navMenu.classList.contains('active')) {
                            navMenu.classList.remove('active');
                            const mobileMenuBtn = document.getElementById('mobileMenuBtn');
                            if (mobileMenuBtn) {
                                mobileMenuBtn.setAttribute('aria-expanded', 'false');
                                mobileMenuBtn.querySelector('i').classList.remove('fa-times');
                                mobileMenuBtn.querySelector('i').classList.add('fa-bars');
                                // Restore body scrolling
                                document.body.style.overflow = '';
                            }
                        }
                    }
                }
            });

            // Handle keyboard navigation
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    document.getElementById('cartSidebar').classList.remove('open');
                    document.getElementById('paymentModal').style.display = 'none';
                    
                    const navMenu = document.getElementById('navMenu');
                    if (navMenu && navMenu.classList.contains('active')) {
                        navMenu.classList.remove('active');
                        const mobileMenuBtn = document.getElementById('mobileMenuBtn');
                        if (mobileMenuBtn) {
                            mobileMenuBtn.setAttribute('aria-expanded', 'false');
                            mobileMenuBtn.querySelector('i').classList.remove('fa-times');
                            mobileMenuBtn.querySelector('i').classList.add('fa-bars');
                            // Restore body scrolling
                            document.body.style.overflow = '';
                        }
                    }
                }
            });

            // Touch event improvements for mobile
            document.addEventListener('touchstart', function() {}, {passive: true});
        }

        // Rest of your JavaScript functions remain exactly the same...
        // Load categories from Firestore
        async function loadCategories() {
            try {
                const querySnapshot = await db.collection("categories").orderBy("name").get();
                allCategories = [];
                const categoriesDropdown = document.getElementById('categoriesDropdown');
                const categoryFilter = document.getElementById('categoryFilter');
                const categoryNav = document.getElementById('categoryNav');
                
                // Clear existing content
                if (categoriesDropdown) categoriesDropdown.innerHTML = '';
                if (categoryFilter) categoryFilter.innerHTML = '';
                if (categoryNav) categoryNav.innerHTML = '';

                // Add "All" option
                const allCategory = {
                    id: 'all',
                    name: 'All Products',
                    filter: 'all',
                    icon: 'fas fa-boxes'
                };
                allCategories.push(allCategory);

                querySnapshot.forEach((doc) => {
                    const category = { id: doc.id, ...doc.data() };
                    allCategories.push(category);
                    
                    // Add to dropdown menu
                    if (categoriesDropdown) {
                        const dropdownItem = document.createElement('a');
                        dropdownItem.href = `#${category.filter || category.id}`;
                        dropdownItem.innerHTML = `
                            <i class="${category.icon || 'fas fa-tag'}"></i>
                            ${category.name}
                        `;
                        dropdownItem.addEventListener('click', (e) => {
                            e.preventDefault();
                            currentFilters.categories = [category.filter || category.id];
                            filterProducts();
                            
                            // Close mobile menu if open
                            if (window.innerWidth < 768) {
                                const navMenu = document.getElementById('navMenu');
                                if (navMenu && navMenu.classList.contains('active')) {
                                    navMenu.classList.remove('active');
                                    const mobileMenuBtn = document.getElementById('mobileMenuBtn');
                                    if (mobileMenuBtn) {
                                        mobileMenuBtn.setAttribute('aria-expanded', 'false');
                                        mobileMenuBtn.querySelector('i').classList.remove('fa-times');
                                        mobileMenuBtn.querySelector('i').classList.add('fa-bars');
                                        // Restore body scrolling
                                        document.body.style.overflow = '';
                                    }
                                }
                                const categoriesMenuItem = document.getElementById('categoriesMenuItem');
                                if (categoriesMenuItem) {
                                    categoriesMenuItem.classList.remove('show-dropdown');
                                }
                            }
                        });
                        categoriesDropdown.appendChild(dropdownItem);
                    }
                    
                    // Add to filter options
                    if (categoryFilter) {
                        const filterOption = document.createElement('div');
                        filterOption.className = 'filter-option';
                        filterOption.innerHTML = `
                            <input type="checkbox" id="cat_${category.id}" value="${category.filter || category.id}">
                            <label for="cat_${category.id}">
                                <i class="${category.icon || 'fas fa-tag'}"></i>
                                ${category.name}
                                <span class="filter-count" id="count_${category.id}">0</span>
                            </label>
                        `;
                        filterOption.querySelector('input').addEventListener('change', updateCategoryFilters);
                        categoryFilter.appendChild(filterOption);
                    }
                    
                    // Add to category navigation
                    if (categoryNav) {
                        const navItem = document.createElement('li');
                        navItem.innerHTML = `
                            <a href="#" data-category="${category.filter || category.id}" class="${category.filter === 'mens' ? 'active' : ''}">
                                <i class="${category.icon || 'fas fa-tag'}"></i>
                                ${category.name}
                            </a>
                        `;
                        categoryNav.appendChild(navItem);
                    }
                });

                // Add "All" to category navigation
                if (categoryNav) {
                    const allNavItem = document.createElement('li');
                    allNavItem.innerHTML = `
                        <a href="#" data-category="all" class="active">
                            <i class="fas fa-boxes"></i>
                            All Products
                        </a>
                    `;
                    categoryNav.insertBefore(allNavItem, categoryNav.firstChild);
                }

            } catch (error) {
                console.error("Error loading categories: ", error);
            }
        }

        // Load products from Firestore
        async function loadProducts() {
            try {
                const querySnapshot = await db.collection("products").get();
                allProducts = [];
                
                querySnapshot.forEach((doc) => {
                    const product = { 
                        id: doc.id, 
                        ...doc.data(),
                        // Ensure we have default values
                        category: doc.data().category || '',
                        color: doc.data().color || '',
                        size: Array.isArray(doc.data().size) ? doc.data().size : 
                              (doc.data().size ? [doc.data().size] : []),
                        images: doc.data().images || [],
                        price: doc.data().price || 0,
                        oldPrice: doc.data().oldPrice || 0,
                        stock: doc.data().stock || 0,
                        featured: doc.data().featured || false,
                        badge: doc.data().badge || '',
                        createdAt: doc.data().createdAt || new Date()
                    };
                    allProducts.push(product);
                });

                // Calculate category counts
                updateCategoryCounts();
                
                // Extract colors and sizes for filters
                extractFilterOptions();
                
                // Initial filter
                filterProducts();

            } catch (error) {
                console.error("Error loading products: ", error);
            }
        }

        // Update category counts
        function updateCategoryCounts() {
            allCategories.forEach(category => {
                if (category.filter === 'all') {
                    const count = allProducts.length;
                    const totalCountElement = document.getElementById('totalProductsCount');
                    if (totalCountElement) {
                        totalCountElement.textContent = count;
                    }
                } else {
                    const count = allProducts.filter(p => 
                        p.category === category.name || 
                        (category.filter && p.category && p.category.toLowerCase().includes(category.filter))
                    ).length;
                    const countElement = document.getElementById(`count_${category.id}`);
                    if (countElement) {
                        countElement.textContent = count;
                    }
                }
            });
        }

        // Extract colors and sizes for filters
        function extractFilterOptions() {
            const colors = new Set();
            const sizes = new Set();
            
            allProducts.forEach(product => {
                if (product.color) {
                    const colorList = product.color.split(',').map(c => c.trim());
                    colorList.forEach(color => colors.add(color));
                }
                
                if (product.size && product.size.length > 0) {
                    product.size.forEach(size => sizes.add(size));
                }
            });
            
            // Add colors
            const colorFilter = document.getElementById('colorFilter');
            if (colorFilter && colors.size > 0) {
                colors.forEach(color => {
                    if (color) {
                        const colorOption = document.createElement('div');
                        colorOption.className = 'color-option';
                        colorOption.title = color;
                        colorOption.setAttribute('role', 'button');
                        colorOption.tabIndex = 0;
                        colorOption.style.backgroundColor = getColorHex(color);
                        colorOption.dataset.color = color;
                        colorOption.addEventListener('click', function() {
                            this.classList.toggle('active');
                            updateColorFilters();
                        });
                        colorOption.addEventListener('keydown', function(e) {
                            if (e.key === 'Enter' || e.key === ' ') {
                                e.preventDefault();
                                this.classList.toggle('active');
                                updateColorFilters();
                            }
                        });
                        colorFilter.appendChild(colorOption);
                    }
                });
            }
            
            // Add sizes
            const sizeFilter = document.getElementById('sizeFilter');
            if (sizeFilter && sizes.size > 0) {
                Array.from(sizes).sort().forEach(size => {
                    if (size) {
                        const sizeOption = document.createElement('div');
                        sizeOption.className = 'size-option';
                        sizeOption.textContent = size;
                        sizeOption.setAttribute('role', 'button');
                        sizeOption.tabIndex = 0;
                        sizeOption.dataset.size = size;
                        sizeOption.addEventListener('click', function() {
                            this.classList.toggle('active');
                            updateSizeFilters();
                        });
                        sizeOption.addEventListener('keydown', function(e) {
                            if (e.key === 'Enter' || e.key === ' ') {
                                e.preventDefault();
                                this.classList.toggle('active');
                                updateSizeFilters();
                            }
                        });
                        sizeFilter.appendChild(sizeOption);
                    }
                });
            }
        }

        // Helper function to get color hex from name
        function getColorHex(colorName) {
            const colorMap = {
                'black': '#000000',
                'white': '#ffffff',
                'blue': '#0000ff',
                'red': '#ff0000',
                'green': '#008000',
                'yellow': '#ffff00',
                'purple': '#800080',
                'pink': '#ffc0cb',
                'orange': '#ffa500',
                'brown': '#a52a2a',
                'gray': '#808080',
                'grey': '#808080',
                'gold': '#ffd700',
                'silver': '#c0c0c0',
                'navy': '#000080',
                'beige': '#f5f5dc',
                'khaki': '#f0e68c',
                'cream': '#fffdd0',
                'charcoal': '#36454f',
                'maroon': '#800000',
                'burgundy': '#800020',
                'teal': '#008080',
                'turquoise': '#40e0d0',
                'lavender': '#e6e6fa',
                'violet': '#ee82ee'
            };
            return colorMap[colorName.toLowerCase()] || '#cccccc';
        }

        // Update category filters
        function updateCategoryFilters() {
            currentFilters.categories = [];
            const checkboxes = document.querySelectorAll('#categoryFilter input:checked');
            if (checkboxes) {
                checkboxes.forEach(checkbox => {
                    currentFilters.categories.push(checkbox.value);
                });
            }
        }

        // Update color filters
        function updateColorFilters() {
            currentFilters.colors = [];
            const activeColorOptions = document.querySelectorAll('.color-option.active');
            if (activeColorOptions) {
                activeColorOptions.forEach(option => {
                    currentFilters.colors.push(option.dataset.color);
                });
            }
        }

        // Update size filters
        function updateSizeFilters() {
            currentFilters.sizes = [];
            const activeSizeOptions = document.querySelectorAll('.size-option.active');
            if (activeSizeOptions) {
                activeSizeOptions.forEach(option => {
                    currentFilters.sizes.push(option.dataset.size);
                });
            }
        }

        // Filter products based on current filters
        function filterProducts() {
            updateCategoryFilters();
            updateColorFilters();
            updateSizeFilters();
            
            filteredProducts = allProducts.filter(product => {
                // Category filter
                if (currentFilters.categories.length > 0) {
                    const categoryMatch = currentFilters.categories.some(cat => {
                        if (cat === 'all') return true;
                        return product.category && product.category.toLowerCase().includes(cat);
                    });
                    if (!categoryMatch) return false;
                }
                
                // Price filter
                if (product.price > currentFilters.price) return false;
                
                // Color filter
                if (currentFilters.colors.length > 0 && product.color) {
                    const productColors = product.color.split(',').map(c => c.trim().toLowerCase());
                    const colorMatch = currentFilters.colors.some(color => 
                        productColors.includes(color.toLowerCase())
                    );
                    if (!colorMatch) return false;
                }
                
                // Size filter
                if (currentFilters.sizes.length > 0 && product.size) {
                    const productSizes = product.size.map(s => s.toString().toUpperCase());
                    const sizeMatch = currentFilters.sizes.some(size => 
                        productSizes.includes(size.toUpperCase())
                    );
                    if (!sizeMatch) return false;
                }
                
                return true;
            });
            
            // Sort products
            sortProducts();
            
            // Reset to first page
            currentPage = 1;
            
            // Update UI
            updateUI();
        }

        // Sort products
        function sortProducts() {
            filteredProducts.sort((a, b) => {
                switch(currentFilters.sortBy) {
                    case 'price-low':
                        return a.price - b.price;
                    case 'price-high':
                        return b.price - a.price;
                    case 'name':
                        return a.name.localeCompare(b.name);
                    case 'newest':
                        return new Date(b.createdAt) - new Date(a.createdAt);
                    case 'popular':
                        return (b.featured ? 1 : 0) - (a.featured ? 1 : 0);
                    default: // featured
                        return (b.badge ? 1 : 0) - (a.badge ? 1 : 0) || 
                               (b.featured ? 1 : 0) - (a.featured ? 1 : 0);
                }
            });
        }

        // Reset all filters
        function resetFilters() {
            currentFilters = {
                categories: [],
                price: 250000,
                colors: [],
                sizes: [],
                sortBy: 'featured'
            };
            
            // Reset UI
            const priceRange = document.getElementById('priceRange');
            const currentPrice = document.getElementById('currentPrice');
            const sortSelect = document.getElementById('sortSelect');
            
            if (priceRange) priceRange.value = 250000;
            if (currentPrice) currentPrice.textContent = formatNaira(250000);
            if (sortSelect) sortSelect.value = 'featured';
            
            document.querySelectorAll('#categoryFilter input:checked').forEach(cb => cb.checked = false);
            document.querySelectorAll('.color-option.active').forEach(co => co.classList.remove('active'));
            document.querySelectorAll('.size-option.active').forEach(so => so.classList.remove('active'));
            document.querySelectorAll('.category-nav a').forEach(a => a.classList.remove('active'));
            
            const allCategoryNav = document.querySelector('.category-nav a[data-category="all"]');
            if (allCategoryNav) allCategoryNav.classList.add('active');
            
            filterProducts();
            const currentCategoryTitle = document.getElementById('currentCategoryTitle');
            if (currentCategoryTitle) currentCategoryTitle.textContent = 'All Products';
        }

        // Update UI
        function updateUI() {
            updateProductsDisplay();
            updateStats();
            updatePagination();
        }

        // Update products display
        function updateProductsDisplay() {
            const productsGrid = document.getElementById('productsGrid');
            const noResults = document.getElementById('noResults');
            
            if (!productsGrid) return;
            
            if (filteredProducts.length === 0) {
                productsGrid.innerHTML = '';
                if (noResults) noResults.style.display = 'block';
                return;
            }
            
            if (noResults) noResults.style.display = 'none';
            
            // Calculate pagination
            const startIndex = (currentPage - 1) * productsPerPage;
            const endIndex = startIndex + productsPerPage;
            const productsToShow = filteredProducts.slice(startIndex, endIndex);
            
            // Clear existing products
            productsGrid.innerHTML = '';
            
            // Set appropriate class for view mode
            productsGrid.className = currentView === 'list' ? 'products-list' : 'products-grid';
            
            // Add products
            productsToShow.forEach(product => {
                const productCard = createProductCard(product);
                productsGrid.appendChild(productCard);
            });
        }

        // Create product card
        function createProductCard(product) {
            const card = document.createElement('div');
            card.className = `product-card ${currentView}-view`;
            
            const imageUrl = product.images && product.images.length > 0 ? product.images[0] : '';
            
            const cardHTML = `
                <div class="product-img">
                    ${imageUrl ? 
                        `<img src="${imageUrl}" alt="${product.name}" loading="lazy" decoding="async">` :
                        `<i class="fas fa-image" style="font-size: 3rem; color: var(--primary-blue);"></i>`
                    }
                    ${product.badge ? `<div class="product-badge">${product.badge}</div>` : ''}
                </div>
                <div class="product-info">
                    <div class="product-category">${product.category || 'Uncategorized'}</div>
                    <h3 class="product-title">${product.name}</h3>
                    <p class="product-description">${product.description || 'No description available.'}</p>
                    <div class="product-meta">
                        ${product.color ? `<span><i class="fas fa-palette"></i> ${product.color}</span>` : ''}
                        ${product.size && product.size.length > 0 ? 
                            `<span><i class="fas fa-ruler"></i> ${product.size.join(', ')}</span>` : ''}
                        <span><i class="fas fa-box"></i> ${product.stock || 0} in stock</span>
                    </div>
                    <div class="price-section">
                        <span class="current-price">${formatNaira(product.price)}</span>
                        ${product.oldPrice ? `<span class="old-price">${formatNaira(product.oldPrice)}</span>` : ''}
                    </div>
                    <div class="product-actions">
                        <button class="btn btn-sm btn-primary add-to-cart-btn" data-product-id="${product.id}">
                            <i class="fas fa-cart-plus"></i> Add to Cart
                        </button>
                        <button class="btn btn-sm btn-gold view-details-btn" data-product-id="${product.id}">
                            <i class="fas fa-eye"></i> View Details
                        </button>
                    </div>
                </div>
            `;
            
            card.innerHTML = cardHTML;
            
            // Add event listeners
            const addToCartBtn = card.querySelector('.add-to-cart-btn');
            if (addToCartBtn) {
                addToCartBtn.addEventListener('click', function() {
                    const productId = this.dataset.productId;
                    addToCart(productId);
                });
            }
            
            const viewDetailsBtn = card.querySelector('.view-details-btn');
            if (viewDetailsBtn) {
                viewDetailsBtn.addEventListener('click', function() {
                    const productId = this.dataset.productId;
                    viewProductDetails(productId);
                });
            }
            
            return card;
        }

        // View product details
        async function viewProductDetails(productId) {
            const product = allProducts.find(p => p.id === productId);
            if (!product) return;
            
            const modalContent = document.createElement('div');
            modalContent.style.padding = '1.25rem';
            modalContent.innerHTML = `
                <div style="display: flex; flex-direction: column; gap: 1.5rem;">
                    <div>
                        <div style="background: var(--light-blue); border-radius: 12px; padding: 1.5rem; display: flex; align-items: center; justify-content: center; height: 250px;">
                            ${product.images && product.images.length > 0 ? 
                                `<img src="${product.images[0]}" alt="${product.name}" style="max-width: 100%; max-height: 100%; object-fit: contain;">` :
                                `<i class="fas fa-image" style="font-size: 4rem; color: var(--primary-blue);"></i>`
                            }
                        </div>
                    </div>
                    <div>
                        <h2 style="color: var(--primary-blue); margin-bottom: 0.75rem; font-size: 1.5rem;">${product.name}</h2>
                        <div style="color: var(--secondary-blue); font-weight: 600; margin-bottom: 0.75rem; font-size: 0.95rem;">
                            ${product.category || 'Uncategorized'}
                        </div>
                        <p style="color: #666; margin-bottom: 1.25rem; line-height: 1.6; font-size: 1rem;">
                            ${product.description || 'No description available.'}
                        </p>
                        <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1.25rem; flex-wrap: wrap;">
                            <span style="font-size: 1.5rem; color: var(--accent-gold); font-weight: 700;">
                                ${formatNaira(product.price)}
                            </span>
                            ${product.oldPrice ? 
                                `<span style="color: #999; text-decoration: line-through; font-size: 1.1rem;">${formatNaira(product.oldPrice)}</span>` : 
                                ''
                            }
                        </div>
                        <div style="margin-bottom: 1.5rem; font-size: 0.95rem;">
                            ${product.color ? `<p><strong>Color:</strong> ${product.color}</p>` : ''}
                            ${product.size && product.size.length > 0 ? 
                                `<p><strong>Size:</strong> ${Array.isArray(product.size) ? product.size.join(', ') : product.size}</p>` : 
                                ''
                            }
                            ${product.stock ? `<p><strong>Stock:</strong> ${product.stock} available</p>` : ''}
                        </div>
                        <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                            <button class="btn btn-primary" id="modalAddToCartBtn" style="flex: 1; min-width: 200px;">
                                <i class="fas fa-cart-plus"></i> Add to Cart
                            </button>
                            <button class="btn btn-outline" onclick="this.closest('.modal').style.display = 'none'" style="flex: 1; min-width: 200px;">
                                <i class="fas fa-times"></i> Close
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            // Create modal if it doesn't exist
            let modal = document.getElementById('productDetailsModal');
            if (!modal) {
                modal = document.createElement('div');
                modal.id = 'productDetailsModal';
                modal.className = 'modal';
                modal.innerHTML = `
                    <div class="payment-modal-content">
                        <div class="payment-header">
                            <h2>Product Details</h2>
                            <button class="close-cart" onclick="this.closest('.modal').style.display = 'none'" aria-label="Close product details">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div id="productDetailsContent"></div>
                    </div>
                `;
                document.body.appendChild(modal);
                
                // Close on overlay click
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        modal.style.display = 'none';
                    }
                });
            }
            
            // Set content and show modal
            document.getElementById('productDetailsContent').innerHTML = '';
            document.getElementById('productDetailsContent').appendChild(modalContent);
            modal.style.display = 'flex';
            
            // Add event listener to modal add to cart button
            const modalAddToCartBtn = document.getElementById('modalAddToCartBtn');
            if (modalAddToCartBtn) {
                modalAddToCartBtn.addEventListener('click', () => {
                    addToCart(productId);
                    modal.style.display = 'none';
                });
            }
        }

        // Update statistics
        function updateStats() {
            const showingCount = Math.min(filteredProducts.length, productsPerPage);
            const activeFilterCount = 
                currentFilters.categories.length + 
                currentFilters.colors.length + 
                currentFilters.sizes.length + 
                (currentFilters.price < 500000 ? 1 : 0);
            
            const productsCountElement = document.getElementById('productsCount');
            const showingCountElement = document.getElementById('showingCount');
            const activeFiltersCountElement = document.getElementById('activeFiltersCount');
            const priceRangeTextElement = document.getElementById('priceRangeText');
            
            if (productsCountElement) productsCountElement.textContent = `${filteredProducts.length} product${filteredProducts.length !== 1 ? 's' : ''}`;
            if (showingCountElement) showingCountElement.textContent = showingCount;
            if (activeFiltersCountElement) activeFiltersCountElement.textContent = activeFilterCount;
            if (priceRangeTextElement) priceRangeTextElement.textContent = 
                `₦0 - ${formatNaira(currentFilters.price)}`;
        }

        // Add to cart
        function addToCart(productId) {
            const product = allProducts.find(p => p.id === productId);
            if (!product) {
                showNotification('Product not found', 'error');
                return;
            }
            
            // Check if item already exists in cart
            const existingItemIndex = cart.findIndex(item => item.id === productId);
            
            if (existingItemIndex !== -1) {
                // Update quantity if item exists
                cart[existingItemIndex].quantity += 1;
            } else {
                // Add new item to cart
                cart.push({
                    id: productId,
                    quantity: 1,
                    name: product.name,
                    price: product.price,
                    image: product.images && product.images.length > 0 ? product.images[0] : '',
                    category: product.category || ''
                });
            }
            
            // Update cart display
            updateCartDisplay();
            
            // Save to localStorage
            localStorage.setItem('sprightlyCart', JSON.stringify(cart));
            
            // Show success notification
            showNotification(`${product.name} added to cart!`, 'success');
            
            // Add haptic feedback on mobile
            if ('vibrate' in navigator) {
                navigator.vibrate(50);
            }
        }

        // Load cart items
        function loadCartItems() {
            const cartItems = document.getElementById('cartItems');
            const cartTotal = document.getElementById('cartTotal');
            
            if (cart.length === 0) {
                cartItems.innerHTML = `
                    <div class="empty-cart">
                        <i class="fas fa-shopping-cart"></i>
                        <h3>Your cart is empty</h3>
                        <p>Add some items to get started!</p>
                    </div>
                `;
                cartTotal.textContent = '₦0';
                return;
            }
            
            let total = 0;
            let itemsHTML = '';
            
            cart.forEach((item, index) => {
                const itemTotal = item.price * item.quantity;
                total += itemTotal;
                
                itemsHTML += `
                    <div class="cart-item">
                        <img src="${item.image}" alt="${item.name}" class="cart-item-img" onerror="this.src='data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"80\" height=\"80\" viewBox=\"0 0 80 80\"><rect width=\"80\" height=\"80\" fill=\"%23e8f0fe\"/><text x=\"50%\" y=\"50%\" font-family=\"Arial\" font-size=\"14\" fill=\"%231a3a8f\" text-anchor=\"middle\" dy=\".3em\">No Image</text></svg>'">
                        <div class="cart-item-details">
                            <div class="cart-item-title">${item.name}</div>
                            <div class="cart-item-price">${formatNaira(item.price)}</div>
                            <div class="cart-item-quantity">
                                <button class="quantity-btn" onclick="updateQuantity(${index}, -1)" aria-label="Decrease quantity">-</button>
                                <span>${item.quantity}</span>
                                <button class="quantity-btn" onclick="updateQuantity(${index}, 1)" aria-label="Increase quantity">+</button>
                            </div>
                        </div>
                        <button class="cart-item-remove" onclick="removeFromCart(${index})" aria-label="Remove item">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
            });
            
            cartItems.innerHTML = itemsHTML;
            cartTotal.textContent = formatNaira(total);
        }

        // Update quantity
        window.updateQuantity = function(index, change) {
            if (cart[index].quantity + change < 1) {
                removeFromCart(index);
                return;
            }
            
            cart[index].quantity += change;
            localStorage.setItem('sprightlyCart', JSON.stringify(cart));
            updateCartDisplay();
            loadCartItems();
        };

        // Remove from cart
        window.removeFromCart = function(index) {
            if (confirm('Are you sure you want to remove this item from your cart?')) {
                cart.splice(index, 1);
                localStorage.setItem('sprightlyCart', JSON.stringify(cart));
                updateCartDisplay();
                loadCartItems();
                showNotification('Item removed from cart', 'success');
            }
        };

        // Update cart display
        function updateCartDisplay() {
            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            const cartCountElement = document.getElementById('cartCount');
            if (cartCountElement) {
                cartCountElement.textContent = totalItems;
            }
        }

        // Show payment modal
        function showPaymentModal() {
            // Load order summary
            const orderSummary = document.getElementById('orderSummary');
            const orderTotal = document.getElementById('orderTotal');
            
            let summaryHTML = '';
            let total = 0;
            
            cart.forEach(item => {
                const itemTotal = item.price * item.quantity;
                total += itemTotal;
                
                summaryHTML += `
                    <div class="summary-item">
                        <span>${item.name} (x${item.quantity})</span>
                        <span>${formatNaira(itemTotal)}</span>
                    </div>
                `;
            });
            
            orderSummary.innerHTML = summaryHTML;
            orderTotal.textContent = formatNaira(total);
            
            // Show modal
            document.getElementById('paymentModal').style.display = 'flex';
        }

        // Handle payment submission
        async function handlePaymentSubmit(e) {
            e.preventDefault();
            
            const submitBtn = document.getElementById('submitOrderBtn');
            const originalText = submitBtn.innerHTML;
            
            // Show loading
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
            submitBtn.disabled = true;
            
            try {
                // Get form data
                const formData = {
                    customerName: document.getElementById('customerName').value.trim(),
                    customerEmail: document.getElementById('customerEmail').value.trim(),
                    customerPhone: document.getElementById('customerPhone').value.trim(),
                    deliveryAddress: document.getElementById('deliveryAddress').value.trim(),
                    additionalNotes: document.getElementById('additionalNotes').value.trim(),
                    orderItems: cart,
                    orderTotal: cart.reduce((sum, item) => sum + (item.price * item.quantity), 0),
                    status: 'pending',
                    paymentMethod: 'bank_transfer',
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                // Validate email
                if (!isValidEmail(formData.customerEmail)) {
                    throw new Error('Please enter a valid email address');
                }
                
                // Validate phone
                if (!isValidPhone(formData.customerPhone)) {
                    throw new Error('Please enter a valid phone number');
                }
                
                // Handle file upload (convert to base64)
                const fileInput = document.getElementById('paymentReceipt');
                if (fileInput.files.length > 0) {
                    const file = fileInput.files[0];
                    if (file.size > 5 * 1024 * 1024) { // 5MB limit
                        throw new Error('File size must be less than 5MB');
                    }
                    
                    // Read file as base64
                    const base64File = await readFileAsBase64(file);
                    formData.paymentReceipt = {
                        fileName: file.name,
                        fileType: file.type,
                        fileSize: file.size,
                        data: base64File
                    };
                } else {
                    throw new Error('Please upload your payment receipt');
                }
                
                // Generate order ID
                const orderId = 'ORD-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);
                formData.orderId = orderId;
                
                // Save order to Firestore
                await db.collection('orders').doc(orderId).set(formData);
                
                // Clear cart
                cart = [];
                localStorage.setItem('sprightlyCart', JSON.stringify(cart));
                updateCartDisplay();
                
                // Reset form
                document.getElementById('paymentForm').reset();
                document.getElementById('fileName').textContent = '';
                
                // Close modal
                document.getElementById('paymentModal').style.display = 'none';
                
                // Show success message
                showNotification('Order submitted successfully! We will contact you shortly.', 'success');
                
                // Auto-redirect after 3 seconds
                setTimeout(() => {
                    window.location.href = 'index.html';
                }, 3000);
                
            } catch (error) {
                console.error('Error submitting order:', error);
                showNotification(error.message || 'Failed to submit order. Please try again.', 'error');
            } finally {
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
            }
        }

        // Read file as base64
        function readFileAsBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result);
                reader.onerror = error => reject(error);
            });
        }

        // Validation helpers
        function isValidEmail(email) {
            const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return re.test(email);
        }

        function isValidPhone(phone) {
            const re = /^[\+]?[1-9][\d]{0,15}$/;
            return re.test(phone.replace(/[\s\-\(\)]/g, ''));
        }

        // Show notification
        function showNotification(message, type) {
            // Remove any existing notifications
            const existingNotifications = document.querySelectorAll('.notification');
            existingNotifications.forEach(notification => {
                notification.style.animation = 'slideOutUp 0.3s ease-out';
                setTimeout(() => {
                    if (notification.parentNode) {
                        document.body.removeChild(notification);
                    }
                }, 300);
            });
            
            // Create notification element
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            
            let icon = 'info-circle';
            switch(type) {
                case 'success':
                    icon = 'check-circle';
                    break;
                case 'error':
                    icon = 'exclamation-circle';
                    break;
            }
            
            notification.innerHTML = `
                <i class="fas fa-${icon}"></i>
                <span>${message}</span>
            `;
            
            document.body.appendChild(notification);
            
            // Remove after 5 seconds
            setTimeout(() => {
                notification.style.animation = 'slideOutUp 0.3s ease-out';
                setTimeout(() => {
                    if (notification.parentNode) {
                        document.body.removeChild(notification);
                    }
                }, 300);
            }, 5000);
        }

        // Update pagination
        function updatePagination() {
            const pagination = document.getElementById('pagination');
            if (!pagination) return;
            
            const totalPages = Math.ceil(filteredProducts.length / productsPerPage);
            
            if (totalPages <= 1) {
                pagination.innerHTML = '';
                return;
            }
            
            let paginationHTML = '';
            
            // Previous button
            if (currentPage > 1) {
                paginationHTML += `
                    <a href="#" class="pagination-prev" onclick="changePage(${currentPage - 1}); return false;" aria-label="Previous page">
                        <i class="fas fa-chevron-left"></i>
                    </a>
                `;
            } else {
                paginationHTML += `<span class="disabled" aria-hidden="true"><i class="fas fa-chevron-left"></i></span>`;
            }
            
            // Page numbers
            for (let i = 1; i <= totalPages; i++) {
                if (i === currentPage) {
                    paginationHTML += `<a href="#" class="active" aria-label="Page ${i}" aria-current="page">${i}</a>`;
                } else if (
                    i === 1 ||
                    i === totalPages ||
                    (i >= currentPage - 1 && i <= currentPage + 1)
                ) {
                    paginationHTML += `<a href="#" onclick="changePage(${i}); return false;" aria-label="Page ${i}">${i}</a>`;
                } else if (
                    i === currentPage - 2 ||
                    i === currentPage + 2
                ) {
                    paginationHTML += `<span aria-hidden="true">...</span>`;
                }
            }
            
            // Next button
            if (currentPage < totalPages) {
                paginationHTML += `
                    <a href="#" class="pagination-next" onclick="changePage(${currentPage + 1}); return false;" aria-label="Next page">
                        <i class="fas fa-chevron-right"></i>
                    </a>
                `;
            } else {
                paginationHTML += `<span class="disabled" aria-hidden="true"><i class="fas fa-chevron-right"></i></span>`;
            }
            
            pagination.innerHTML = paginationHTML;
        }

        // Change page
        window.changePage = function(page) {
            currentPage = page;
            updateProductsDisplay();
            updatePagination();
            // Scroll to top of products section
            const productsSection = document.querySelector('.products-section');
            if (productsSection) {
                productsSection.scrollIntoView({ behavior: 'smooth' });
            }
        };
    </script>
</body>
</html>